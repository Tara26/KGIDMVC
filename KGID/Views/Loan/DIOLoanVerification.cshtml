@model KGID_Models.KGIDLoan.VM_LoanApplicationModel

@{
    ViewBag.Title = "DIO Verification";
}

<style>
    .m-t-10 {
        margin-top: 10px;
    }

    .f-s-15 {
        line-height: 18px;
    }

    .row {
        margin-left: 0px !important;
        margin-right: 0px !important;
    }

    .pad-0 {
        padding: 0px !important;
        margin: 0px !important;
    }

    .in-s {
        height: 25px !important;
        width: 60%;
        padding: 3px;
        font-size: 12px;
    }

    .in-s-r {
        height: 25px !important;
        padding: 3px;
        font-size: 12px;
    }

    .in-b-s {
        display: flex;
        padding: 2px;
        height: 25px;
        width: 20%;
        margin: 0px;
    }

    .nav-style {
        color: #2c44a1 !important;
    }

    /*.nav-tabs .nav-item.show .nav-link, .nav-tabs .nav-link.active {
        color: #fff !important;
        background-color: #2c44a1 !important;
        border-color: #dee2e6 #dee2e6 #fff !important;
    }

    .nav-tabs .nav-link:focus, .nav-tabs .nav-link {
        border-color: #e9ecef #e9ecef #dee2e6 !important;
    }*/

    .w-color {
        color: #fff !important;
    }

    .nav-tabs .nav-item.show .nav-link, .nav-tabs .nav-link.active {
        color: #ffffff !important;
        background-color: #2184bed1 !important;
        border-color: #dee2e6 #dee2e6 #2184be !important;
        font-size: 14px;
        font-weight: 400;
    }

    #navmenu .nav-link {
        border: 1px solid #d8d8d885 !important;
        margin: .5px;
    }

    .bs-example {
        margin: 20px;
    }

    .p_10 {
        padding: 10px;
    }

    .t-background {
        background: #dfddd8;
    }

    .t_head {
        background: #308385;
        color: #fff;
    }
</style>

<div class="row">
    <div class="col-lg-12">
        <div class="card shadow mb-4" style="width: 90%; margin: 0 auto;">
            <div class="card-header">
                <h6 class="m-0 font-weight-bold text-primary" style="padding-left: 15px;"><b>Loan Details</b></h6>
            </div>
            <div class="card-body">
                @Html.Hidden("EmployeeID", Session["UID"])
                <div class="form-group">
                    <b>Employee Name:</b><span id="spnLEName">@Model.EmployeeName</span> | <b>Application Referance Number:</b><span id="spnLRNo">@Model.LoanReferenceNo</span>
                </div>
                <nav id="navmenu">
                    <div class="nav nav-tabs nav-fill" id="nav-tab" role="tablist">
                        <a id="nav-tab-Workflow" class="nav-item nav-link active" data-toggle="tab" href="#workflow" role="tab" aria-controls="workflow" aria-selected="false"><b>Workflow Details</b></a>
                        <a id="nav-tab-Form" class="nav-item nav-link" data-toggle="tab" href="#applicationForm" role="tab" aria-controls="applicationForm" aria-selected="true"><b>Application Form</b></a>
                        <a id="nav-tab-Scrutiny" class="nav-item nav-link" data-toggle="tab" href="#scrutiny" role="tab" aria-controls="scrutiny" aria-selected="false"><b>Scrutiny</b></a>
                    </div>
                </nav>

                <div class="tab-content t-background" id="tab-data">
                    <div id="workflow" class="container tab-pane show active">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-12">
                                    <table class="table table-striped table-bordered" id="tblWorkflowData" cellspacing="0">
                                        <thead class="t_head">
                                            <tr>
                                                <th>Submitted Date</th>
                                                <th>From</th>
                                                <th>To</th>
                                                <th>Remarks</th>
                                                <th>Comments</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var item in Model.WorkFlowData)
                                            {
                                                <tr>
                                                    <td>@item.CreationDateTime</td>
                                                    <td>@item.From</td>
                                                    <td>@item.To</td>
                                                    <td>@item.law_remarks</td>
                                                    <td>@item.law_comments</td>
                                                    <td>@item.law_application_status</td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="row">
                                <div class="form-group col-12 text-right">
                                    <a id="btnWFNext" class="btn btn-primary btn-sm text-white">Next</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="applicationForm" class="container tab-pane">

                        <div class="card-body">
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="row">
                                        <div class="col-12">
                                            <table class="table table-striped table-bordered" id="tblViewLoan" cellspacing="0">
                                                <thead class="t_head">
                                                    <tr>
                                                        <th>Reference No.</th>
                                                        <th>Date of Sanction</th>
                                                        <th>Sum Assured</th>
                                                        <th>Premium Amount</th>
                                                        @*<th>Total Premium Installments</th>*@
                                                        @*<th>Eligible Loan Amount</th>*@
                                                        <th>Loan Amount</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @foreach (var item in Model.PolicyData)
                                                    {
                                                        <tr>
                                                            <td>@item.PolicyNumber</td>
                                                            <td>@item.DateOfSanction.ToString("dd/MM/yyyy")</td>
                                                            <td>@item.SumAssured</td>
                                                            <td>@item.PremiumAmount</td>
                                                            @*<td>@item.NoOfPremiums</td>*@
                                                            @*<td>@item.EligibleLoanAmount</td>*@
                                                            <td>@item.EnterAmount</td>
                                                        </tr>
                                                    }
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    @if (Model.HRMSPayDetails[0].payscaletype == "paydocument")
                                    {
                                        <div class="row">
                                            <div class="form-group col-6">
                                                <label class="col-8">HRMS PaySlip:</label>
                                                @Html.ActionLink("Download", "ViewFilePath", "Home", new { FilePath = @Model.HRMSPayDetails[0].payscaledocument }, htmlAttributes: new { @target = "_blank", @class = "col-4 font-weight-bold" })
                                            </div>
                                            <input type="hidden" class="form-control in-s" id="HrmsPaySlipHidden" name="HrmsPaySlipHidden" value="1" />
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="row">
                                            <div class="form-group col-12">
                                                <table class="table table-striped table-bordered" id="HRMSPayScaleList" cellspacing="0">
                                                    <thead class="t_head">
                                                        <tr>
                                                            <th>Emp Id</th>
                                                            <th>Month</th>
                                                            <th>Year</th>
                                                            <th>Gross Pay</th>
                                                            <th>Deductions</th>
                                                            <th>Net Pay</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        @if (Model.HRMSPayDetails.Any())
                                                        {
                                                            foreach (var item in Model.HRMSPayDetails)
                                                            {
                                                                <tr data-row-number="@item.hrms_emp_id">
                                                                    <td hidden> @item.hrms_emp_id </td>
                                                                    <td>@item.hrms_month</td>
                                                                    <td>@item.hrms_year</td>
                                                                    <td>@item.hrms_gross_pay</td>
                                                                    <td>@item.hrms_deduction</td>
                                                                    <td>@item.hrms_net_pay</td>
                                                                </tr>
                                                            }
                                                        }
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <input type="hidden" class="form-control in-s" id="HrmsPaySlipHidden" name="HrmsPaySlipHidden" value="0" />
                                    }
                                    <div class="row">
                                        <div class="form-group col-6">
                                            <label class="col-8">Enter Amount:</label>
                                            <span class="col-4 font-weight-bold">@Model.EnteredAmount</span>
                                        </div>
                                        <div class="form-group col-6">
                                            <label class="col-8">Branch Adjustments:</label>
                                            <span class="col-4 font-weight-bold">@Model.Deductions</span>

                                        </div>
                                        <div class="form-group col-6">
                                            <label class="col-8">Net Amount:</label>
                                            <span class="col-4 font-weight-bold" id="spnNetAmt">@Model.NetAmount</span>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="form-group col-6">
                                            <label class="col-8">Monthly Installment Amount of principle: </label>
                                            <span class="col-4 font-weight-bold">@Model.PrincipleInstallmentAmt</span>
                                        </div>
                                        <div class="form-group col-6">
                                            <label class="col-8">No of Principle Loan Amount Installments:</label>
                                            <span class="col-4 font-weight-bold">@Model.NoOfPrincipleInstallments</span>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="form-group col-6">
                                            <label class="col-8">Monthly Installment Amount of Loan Interest: </label>
                                            <span class="col-4 font-weight-bold">@Model.InterestInstallmentAmt</span>
                                        </div>
                                        <div class="form-group col-6">
                                            <label class="col-8">No of Loan Interest Installments:</label>
                                            <span class="col-4 font-weight-bold">@Model.NoOfIntrestInstallments</span>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="form-group  col-6">
                                            <label class="col-8">Purpose: </label>
                                            <span class="col-4 font-weight-bold">@Model.PurposeName</span>
                                        </div>
                                    </div>

                                    @if (Model.FamilyRelationId == 0)
                                    {
                                        <div class="row">
                                            <div class="form-group col-6">
                                                <label class="col-8">Are you taking loan for self:</label>
                                                <span class="col-4 font-weight-bold">yes</span>
                                            </div>
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="row">
                                            <div class="form-group col-6 FamilLoanPurpose">
                                                <label class="col-8">Name:</label>

                                                @if (Model.FamilyRelationName != null)
                                                {
                                                    <span class="col-4 font-weight-bold">@Model.FamilyRelationName</span>
                                                }
                                                else
                                                {
                                                    <span class="col-4 font-weight-bold"></span>
                                                }

                                            </div>
                                            <div class="form-group col-6 FamilLoanPurpose">
                                                <label class="col-8">Family member for whom taking loan: </label>
                                                @if (Model.FamilyRelationDesc != null)
                                                {
                                                    <span class="col-4 font-weight-bold">@Model.FamilyRelationDesc</span>
                                                }
                                                else
                                                {
                                                    <span class="col-4 font-weight-bold"></span>
                                                }
                                            </div>

                                        </div>
                                        <div class="row">
                                            <div class="form-group col-6 FamilLoanPurpose">
                                                <label class="col-8">Age:</label>

                                                @if (Model.FamilyRelationAge > 0)
                                                {
                                                    <span class="col-4 font-weight-bold">@Model.FamilyRelationAge</span>
                                                }
                                                else
                                                {
                                                    <span class="col-4 font-weight-bold"></span>
                                                }
                                            </div>
                                            <div class="form-group col-6 FamilLoanPurpose">

                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="row">
                                <div class="form-group col-12  text-right">
                                    <a id="btnAFPrevious" class="btn btn-primary btn-sm text-white">Previous</a>
                                    <a id="btnAFNext" class="btn btn-primary btn-sm text-white">Next</a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="scrutiny" class="container tab-pane">
                        <div class="card-body">
                            @Html.HiddenFor(m => m.LoanApplicationId, new { id = "hdnLoanAppID" })
                            <div class="form-group">
                                <div class="row">
                                    <div class="col-6">
                                        <div class="row col-12">
                                            <label id="lblPolicyNumber" class="control-label col-6 required pt-0">Is Loan Eligibility Verified</label>
                                            <div class="form-group col-6">
                                                @Html.CheckBox("VerifyLoanEligibility", new { @id = "loanEligibility", @class = "chk-req" })  <b>Verified</b>
                                                <label id="errloanEligibility" class="text-danger col-12 pt-2 err" hidden>Please verify eligibility for loan</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="row col-12">
                                            <label id="lblPolicyNumber" class="control-label col-6 required pt-0">Is Loan Request Details Verified</label>
                                            <div class="form-group col-6">
                                                @Html.CheckBox("VerifyLoanRequest", new { @id = "loanRequest", @class = "chk-req" })  <b>Verified</b>
                                                <label id="errloanRequest" class="text-danger col-12 pt-2 err" hidden>Please verify loan request details</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="row">
                                    <div class="col-6">
                                        <div class="row col-12">
                                            <label id="lblPolicyNumber" class="control-label col-6 required pt-0">Is Loan Purpose Details Verified</label>
                                            <div class="form-group col-6">
                                                @Html.CheckBox("VerifyLoanPurpose", new { @id = "loanPurpose", @class = "chk-req" })  <b>Verified</b>
                                                <label id="errloanRequest" class="text-danger col-12 pt-2 err" hidden>Please verify loan purpose details</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-6">

                                    </div>
                                </div>
                            </div>
                            <div class="row col-12">
                                <div class="form-group col-6">
                                    <label for="txtRemarks" class="control-label">Remarks</label>
                                    @Html.DropDownList("Remarks",
                                         new SelectList(KGID.Models.VM_Remarks.GetRemarkList(2), "Value", "Text"),
                                            new { @id = "ddlRemarks", @class = "form-control" })
                                    <label id="errRemarks" class="text-danger pt-2 err" hidden>Please select remarks</label>
                                </div>
                                <div class="form-group col-6">
                                    <label for="txtComments" class="control-label">Comment</label>
                                    @Html.TextArea("Comments", new { @id = "txtComments", @class = "form-control" })
                                    <label id="errComments" class="text-danger pt-2 err" hidden>Please enter comments</label>
                                </div>
                            </div>
                            <div class="row col-12">
                                <div class="row col-12">
                                    <div class="row col-8">
                                        <div class="col-12">
                                            <label class="col-6" id="lblSendToEmp">
                                                @Html.RadioButton("ApplicationStatus", 2, new { id = "rdBtnSendBackToEmp", @class = "float-left", @checked = "checked", @onclick = "ChangeAppStatus();" })
                                                <span class="float-left ml-1">Send Back to Employee</span>
                                            </label>
                                        </div>
                                        @if (@Model.EnteredAmount >= 800001 && @Model.EnteredAmount <= 1200000)
                                        {
                                            <div id="divApprove" class="col-12">
                                                <label class="col-6">
                                                    @Html.RadioButton("ApplicationStatus", 12, new { id = "rdBtnApprove", @class = "float-left", @checked = "checked", @onclick = "ChangeAppStatus();" })
                                                    <span class="float-left ml-1">Send to Deputy Director</span>
                                                </label>
                                            </div>
                                        }
                                        else if (@Model.EnteredAmount >= 1200001)
                                        {
                                            <div id="divApprove" class="col-12">
                                                <label class="col-6">
                                                    @Html.RadioButton("ApplicationStatus", 13, new { id = "rdBtnForwardToD", @class = "float-left", @checked = "checked", @onclick = "ChangeAppStatus();" })
                                                    <span class="float-left ml-1">Send to Director</span>
                                                </label>
                                            </div>
                                        }
                                        else
                                        {
                                            <div id="divApprove" class="col-12">
                                                <label class="col-6">
                                                    @Html.RadioButton("ApplicationStatus", 15, new { id = "rdBtnForwardToD", @class = "float-left", @checked = "checked", @onclick = "ChangeAppStatus();" })
                                                    <span class="float-left ml-1">Accept</span>
                                                </label>
                                            </div>
                                            <div id="divReject" class="col-12">
                                                <label class="col-6">
                                                    @Html.RadioButton("ApplicationStatus", 18, new { id = "rdBtnApprove", @class = "float-left", @onclick = "ChangeAppStatus();" })
                                                    <span class="float-left ml-1">Reject</span>
                                                </label>
                                            </div>
                                        }
                                        <label class="errAction text-danger col-12 pt-2" hidden>Please select action to be taken</label>
                                    </div>
                                    <div class="col-4">
                                        <button id="btnDIOSubmit" type="button" class="btn btn-success" onclick="IntimationToInsured();">Send</button>
                                        <button id="btnDIOClear" class="btn btn-danger">Clear</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="mdlDA" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document" style="max-width: 725px!important;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Disburse Amount Confirmation</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="col-12">
                    <label id="lblDisburseStmt">Loan Amount to be disbursed : </label> <label id="lbldisburseamtvalue"></label>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="btnDisburse">Disburse</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script src="~/Scripts/Loan/DIOLoanVerification.js"></script>

<script type="text/javascript">
    window.onload = function () {
        history.pushState("/kgid-dio-loan-verification/?empId=1&loanApplicationId=5", null, "/kgid-dio-loan-verification/")
    }
</script>