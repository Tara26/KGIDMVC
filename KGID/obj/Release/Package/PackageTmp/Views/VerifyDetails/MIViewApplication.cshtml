@model KGID_Models.KGID_VerifyData.VM_MotorInsuranceDeptVerficationDetails
@{
    ViewBag.Title = "View Application";
    string url = @Request.RawUrl;
    string[] QueryString = url.Split('/');
}
<script src="~/Scripts/KGIDMotorInsurance/MotorInsurance.js"></script>
<style>
    .nav-tabs .nav-item.show .nav-link, .nav-tabs .nav-link.active {
        color: #ffffff !important;
        background-color: #2184bed1 !important;
        border-color: #dee2e6 #dee2e6 #2184be !important;
        font-size: 14px;
        font-weight: 400;
        cursor: pointer !important;
    }

    #navmenu .nav-link {
        border: 1px solid #d8d8d885 !important;
        margin: .5px;
    }

    .bs-example {
        margin: 20px;
    }

    .accordion .fa {
        margin-right: 0.5rem;
    }

    .headinglink {
        cursor: pointer;
        color: #007bff !important;
    }

    .sidebar .closebtn {
        position: absolute;
        top: 0;
        right: 25px;
        font-size: 36px;
        margin-left: 50px;
    }

    .sidebar {
        height: 88%;
        width: 0;
        position: absolute;
        z-index: 1;
        top: 8.5%;
        right: 3%;
        background-color: #fff;
        overflow-x: hidden;
        transition: 0.5s;
        padding-top: 33px;
        resize: vertical;
    }

    .clsFrame {
        max-width: 100%;
        height: 100%;
        background-color: #fff;
    }

    #iViewApp {
        height: 100%;
        width: 100%;
    }

    .sidebar .fullscnbtn {
        position: absolute;
        top: 0;
        right: 55px;
        font-size: 21px;
        margin-left: 50px;
        margin-top: 7px;
    }
</style>

<div class="row">
    <div class="col-lg-12">
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary"><b>View Application</b></h6>
                @Html.Hidden("EmpCode", QueryString[2])
                @Html.Hidden("ApplicationRefNo", QueryString[3])
                @Html.Hidden("Category", QueryString[5])
                @Html.Hidden("ApplicationId", QueryString[3])
            </div>
            <div class="card-body">
                <div class="form-group">
                    <b>Employee/Agency/Dept Name : </b><label id="lblMIEName">@Model.WorkFlowDetails.Select(a => a.NameOfApplicant).FirstOrDefault()</label> | <b>Application Reference Number : </b><label id="lblMIRef">@Model.WorkFlowDetails.Select(a => a.ApplicationRefNo).FirstOrDefault()</label>
                </div>
                <nav id="navmenu">
                    <div class="nav nav-tabs nav-fill" id="nav-tab" role="tablist">
                        <a id="nav-tab-Form" class="nav-item nav-link active" data-toggle="tab" href="#applicationForm" role="tab" aria-controls="applicationForm" aria-selected="true"><b>Application Form</b></a>

                    </div>
                </nav>

                <div class="tab-content py-3 px-3 px-sm-0" id="nav-tabContent" style="background: #dfddd8;padding: 2.5%!important;">
                    <div class="tab-pane fade show active" id="applicationForm" role="tabpanel" aria-labelledby="nav-home-tab">
                        <div id="applicationFormTab" class="application-tab">
                            <section>
                                <div class="bs-example">
                                    <div class="accordion" id="accordionExample">
                                        <div class="card" id="divPanel1">
                                            <div class="card-header" id="headingOne">
                                                <h2 class="mb-0">
                                                    <button id="btncollapseOne" type="button" class="btn btn-link" data-toggle="collapse" data-target="#collapseOne"><i class="fa fa-plus"></i> View Proposer Details</button>
                                                </h2>
                                            </div>
                                            <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordionExample">
                                                <div class="card-body">
                                                    <h2 class="text-center">Proposer Details</h2>
                                                    <hr />

                                                    <div id="divMIPD"></div>
                                                    <hr />


                                                </div>
                                            </div>
                                        </div>
                                        <div class="card" id="divPanel2">
                                            <div class="card-header" id="headingTwo">
                                                <h2 class="mb-0">
                                                    <button id="btncollapseTwo" type="button" class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseTwo"><i class="fa fa-plus"></i> View Vehicle  Details</button>
                                                </h2>
                                            </div>
                                            <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionExample">
                                                <div class="card-body">
                                                    <h2 class="text-center">Vehicle Details</h2>
                                                    <hr />

                                                    <div id="divMIVD"></div>
                                                    <hr />


                                                </div>
                                            </div>
                                        </div>
                                        <div class="card" id="divPanel3">
                                            <div class="card-header" id="headingThree">
                                                <h2 class="mb-0">
                                                    <button id="btncollapseThree" type="button" class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseThree"><i class="fa fa-plus"></i> View Other Details</button>
                                                </h2>
                                            </div>
                                            <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordionExample">
                                                <div class="card-body">
                                                    <h2 class="text-center">Other Details</h2>
                                                    <hr />

                                                    <div id="divMIOD"></div>
                                                    <hr />


                                                </div>
                                            </div>
                                        </div>
                                        <div class="card" id="divPanel4">
                                            <div class="card-header" id="headingFour">
                                                <h2 class="mb-0">
                                                    <button id="btncollapseFour" type="button" class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseFour"><i class="fa fa-plus"></i> View IDV Details</button>
                                                </h2>
                                            </div>
                                            <div id="collapseFour" class="collapse" aria-labelledby="headingFour" data-parent="#accordionExample">
                                                <div class="card-body">
                                                    <h2 class="text-center">IDV Details</h2>
                                                    <hr />

                                                    <div id="divMIIDV"></div>
                                                    <hr />


                                                </div>
                                            </div>
                                        </div>
                                        <div class="card" id="divPanel5">
                                            <div class="card-header" id="headingFive">
                                                <h2 class="mb-0">
                                                    <button id="btncollapseFive" type="button" class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseFive"><i class="fa fa-plus"></i> View Previous History Details</button>
                                                </h2>
                                            </div>
                                            <div id="collapseFive" class="collapse" aria-labelledby="headingFive" data-parent="#accordionExample">
                                                <div class="card-body">
                                                    <h2 class="text-center">Previous History Details</h2>
                                                    <hr />

                                                    <div id="divMIPHD"></div>
                                                    <hr />



                                                </div>
                                            </div>
                                        </div>
                                        <div class="card" id="divPanel6">
                                            <div class="card-header" id="headingSIX">
                                                <h2 class="mb-0">
                                                    <button id="btncollapseSIX" type="button" class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseSIX"><i class="fa fa-plus"></i> View Document Details</button>
                                                </h2>
                                            </div>
                                            <div id="collapseSIX" class="collapse" aria-labelledby="headingSIX" data-parent="#accordionExample">
                                                <div class="card-body">
                                                    <h2 class="text-center">Document Details</h2>
                                                    <hr />

                                                    <div id="divMIDoc"></div>
                                                    
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card" id="divPanel7">
                                            <div class="card-header" id="headingSeven">
                                                <h2 class="mb-0">
                                                    <button id="btncollapseSeven" type="button" class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseSeven"><i class="fa fa-plus"></i> View Payment Details</button>
                                                </h2>
                                            </div>
                                            <div id="collapseSeven" class="collapse" aria-labelledby="headingSeven" data-parent="#accordionExample">
                                                <div class="card-body">
                                                    <h2 class="text-center">Payment Details</h2>
                                                    <hr />

                                                    <div id="divMIPAD"></div>
                                                    
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </section>
                        </div>

                        <div id="viewSidebar" class="sidebar" style="display:none;">
                            <a href="javascript:void(0)" class="closebtn" onclick="closeNav()" title="Close">×</a>
                            @*<a href="javascript:void(0)" class="fullscnbtn" onclick="fullScreenView()" title="View full screen"><i class="fa fa-toggle-left"></i></a>*@
                            <div class="clsFrame">
                                <iframe id="iViewApp" src=""></iframe>
                            </div>
                        </div>
                    </div>


                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    var ColOneLoaded = false;
    var ColTwoLoaded = false;
    var ColThreeLoaded = false;
    var ColFourLoaded = false;
    var ColFiveLoaded = false;
    var ColSIXLoaded = false;
    var ColSevenLoaded = false;
    $(document).ready(function () {
        // Add minus icon for collapse element which is open by default
        $(".collapse.show").each(function () {
            $(this).prev(".card-header").find(".fa").addClass("fa-minus").removeClass("fa-plus");
        });

        // Toggle plus minus icon on show hide of collapse element
        $(".collapse").on('show.bs.collapse', function () {
            $(this).prev(".card-header").find(".fa").removeClass("fa-plus").addClass("fa-minus");
        }).on('hide.bs.collapse', function () {
            $(this).prev(".card-header").find(".fa").removeClass("fa-minus").addClass("fa-plus");
        });

        $("#spnEName").text($("#spnProposerName").text());
        $("#spnRNo").text($("#hdnBReferanceNo").val());
        $('#tblDDOApprovedData').DataTable({
            paging: false,
            info: false,
            ordering: false,
            searching: false
        });


        $(".nav-item").click(function (e) {
            $("#viewSidebar")[0].style.width = "0";
            $("#applicationFormTab")[0].style.marginRight = "0";
        });
        
    });
   

    function ShowApplicationDetails(id) {
        $("#divBDetails").hide();
        $("#divFNDetails").hide();
        $("#divPMLDetails").hide();
        if (id == 1) {
            $("#divBDetails").show();
        } else if (id == 2) {
            $("#divFNDetails").show();
        } else if (id == 3) {
            $("#divPMLDetails").show();
        }
        $("#mdBasicDetails").modal("show");
    }
    $("#btnSubmit").click(function (e) {
        $(".err").hide();

        $(".chk-req").each(function () {
            if (!$(this).is(":checked")) {
                $(this).siblings(".err").show();
            }
        });

        var isStatusSelected = true;
        if ($("input[name='ApplicationStatus']:checked").length === 0) {
            $("input[name='ApplicationStatus']").parent().siblings(".err").show();
            isStatusSelected = false;
        }

        var isCheckboxchecked = true;
        if ($(".err:visible").length > 0) {
            isCheckboxchecked = false;
        }

        var isSendBack = true;
        if ($("input[name='ApplicationStatus']:checked").val() === "2" && $("#txtRemarks").val() === "") {
            $("#errRemarksReq").show();
            isSendBack = false;
        }

        if (isStatusSelected && isCheckboxchecked && isSendBack) {
            alertify.confirm("Are you sure you want to submit the changes?", function () {
                $("#frmDDOVerDetails").submit();
            }).setHeader("Confirm changes?");
        }

        e.preventDefault();
    });

    function ChangeVerificationStatus(destid, srcid) {
        var verificationstatus = $("#" + srcid).prop("checked");
        $("#" + destid).prop("checked", verificationstatus);
    }
    $("#btnClear").click(function () {
        $("#ddlRemarks").val("");
        $("#txtComments").val("");
        $("#rbtnBackToEmployee").prop("checked", false);
        $("#rbtnForwardToCW").prop("checked", false);
        $(".verify").prop("checked", false);
    })
    function showtab(btnid, divid) {
        $("#applicationForm").removeClass("fade").addClass("active show");
        $("#nav-tab-Form").attr("aria-selected", "true");
        $("#scrutiny").removeClass("active show").addClass("fade");
        $("#nav-tab-Scrutiny").attr("aria-selected", "false");
        $("#nav-tab-Form").addClass("active show");
        $("#nav-tab-Scrutiny").removeClass("active show");
        $(".collapse").removeClass("show");
        $(".card-header > h2 > button").attr("aria-expanded", "false");
        $(".card-header > h2 > button > i").removeClass("fa-minus").addClass("fa-plus");
        $("#" + btnid > button).attr("aria-expanded", "true").removeClass("collapsed");
        $("#divid").addClass("show");
    }
    function closeNav() {
        $("#viewSidebar")[0].style.width = "0";
        $("#applicationFormTab")[0].style.marginRight = "0";
    }

    $("#btncollapseOne").click(function () {
        // alert("HI");
        var category = $('#Category').val();
        if (!ColOneLoaded) {
            $.ajax({
                url: '/ViewDataToVerify/ProposerDetailsToView',
                data: JSON.stringify({ "Category": category, }),
                type: 'POST',
                async: false,
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    $("#divMIPD").html(data);
                }
            });

            ColOneLoaded = true;
        }
    })
    $("#btncollapseTwo").click(function () {
        if (!ColTwoLoaded) {

            $.ajax({
                url: '/ViewDataToVerify/VehicleDetailsToView',
                data: JSON.stringify({}),
                type: 'POST',
                async: false,
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    $("#divMIVD").html(data);
                }
            });
            ColTwoLoaded = true;
        }
    })
    $("#btncollapseThree").click(function () {
        if (!ColThreeLoaded) {
            $.ajax({
                url: '/ViewDataToVerify/OtherDetailsToView',
                data: JSON.stringify({}),
                type: 'POST',
                async: false,
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    $("#divMIOD").html(data);
                }
            });

            ColThreeLoaded = true;
        }
    })
    $("#btncollapseFour").click(function () {
        if (!ColFourLoaded) {
            $.ajax({
                url: '/ViewDataToVerify/IDVDetailsToView',
                data: JSON.stringify({}),
                type: 'POST',
                async: false,
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    $("#divMIIDV").html(data);
                }
            });

            ColFourLoaded = true;
        }
    })
    $("#btncollapseFive").click(function () {
        if (!ColFiveLoaded) {
            $.ajax({
                url: '/ViewDataToVerify/PreviousHistoryToView',
                data: JSON.stringify({}),
                type: 'POST',
                async: false,
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    $("#divMIPHD").html(data);
                }
            });

            ColFiveLoaded = true;
        }
    })
    $("#btncollapseSIX").click(function () {
        if (!ColSIXLoaded) {
            $.ajax({
                url: '/ViewDataToVerify/UploadedDocumentsToView',
                type: 'POST',
                async: false,
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    $("#divMIDoc").html(data);
                }
            });

            ColSIXLoaded = true;
        }
    })

    $("#btncollapseSeven").click(function () {
        var empId = $('#EmpCode').val();
        var applicationId = $('#ApplicationRefNo').val();
        if (!ColSevenLoaded) {
            $.ajax({
                url: '/ViewDataToVerify/MIPaymentDetailsToView',
                data: JSON.stringify({
                    "empId": empId, "applicationId": applicationId
                }),
                type: 'POST',
                async: false,
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    $("#divMIPAD").html(data);
                }
            });

            ColSevenLoaded = true;
        }
    })

</script>


